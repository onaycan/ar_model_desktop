<!DOCTYPE html>
<html>
  <head>
    <meta charset=UTF-8 />
    <link rel="stylesheet" type="text/css" href="styles.css" />
  </head>
  <body>
    <script src="js/three.js"></script>
    <script src="js/GLTFLoader.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/StereoEffect.js"></script>
    <script>
      let scene, camera, renderer;

      function init() {


        container_back = document.createElement( 'div' );
				container_back.style.position = "absolute"
				
				container_front = document.createElement( 'div' );
				container_front.style.position = "absolute"
				
				document.body.appendChild( container_back );
        document.body.appendChild( container_front );
        
        var loader_back = new THREE.TextureLoader()
          .load('./cat.jpg');
          
        scene = new THREE.Scene();
        scene.background = null
        //scene.background = loader_back
        //scene.background = new THREE.Color(0xdddddd);

        scene_back = new THREE.Scene();
        scene_back.background = loader_back

        camera = new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,5000);
        camera.rotation.y = -90/180*Math.PI;
        camera.position.x = 0;
        camera.position.y = 1.65;
        camera.position.z = -0.5;

        
        
        
        hlight = new THREE.AmbientLight (0x404040,1);
        scene.add(hlight);

        directionalLight = new THREE.DirectionalLight(0xffffff,1);
        directionalLight.position.set(0,1,0);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        light = new THREE.PointLight(0xc4c4c4,1);
        light.position.set(0,300,500);
        scene.add(light);
        light2 = new THREE.PointLight(0xc4c4c4,1);
        light2.position.set(500,100,0);
        scene.add(light2);
        light3 = new THREE.PointLight(0xc4c4c4,1);
        light3.position.set(0,100,-500);
        scene.add(light3);
        light4 = new THREE.PointLight(0xc4c4c4,1);
        light4.position.set(-500,300,500);
        scene.add(light4);
        
        
        // Instantiate a loader
        var loader = new THREE.GLTFLoader();
            
        
        // Load a glTF resource
        loader.load(
        	// resource URL
        	'./model/scene.gltf',
        	// called when the resource is loaded
        	function ( gltf ) {
            
        		scene.add( gltf.scene );
            
        		gltf.animations; // Array<THREE.AnimationClip>
        		gltf.scene; // THREE.Group
        		gltf.scenes; // Array<THREE.Group>
        		gltf.cameras; // Array<THREE.Camera>
        		gltf.asset; // Object
                
        	},
        	// called while loading is progressing
        	function ( xhr ) {
            
        		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
            
        	},
        	// called when loading has errors
        	function ( error ) {
            
        		console.log( 'An error happened' );
            
          }
        
        
          
        );

        renderer = new THREE.WebGLRenderer({ alpha: true, premultipliedAlpha: false, antialias: true });
        renderer.setClearColor( 0x000000, 0 );
        renderer.setSize(window.innerWidth,window.innerHeight);
        
        renderer_back = new THREE.WebGLRenderer({antialias:true});
        renderer_back.setSize(window.innerWidth,window.innerHeight);
        
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enabled = true
        //this gives you the direction you look, as well as the rotation
        controls.target = new THREE.Vector3(0, 1.6, -0.35);
        controls.update();
        renderer.render(scene_back, camera);
        
        effect = new THREE.StereoEffect( renderer );
				effect.setSize( window.innerWidth, window.innerHeight );
        
        container_front.appendChild(renderer.domElement);
        container_back.appendChild(renderer_back.domElement);

      }
      function animate() {
        requestAnimationFrame(animate);
        renderer_back.render(scene_back, camera);				
        renderer.autoClear = true;
        renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.clear();
				renderer.clearDepth();
				render();
        renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.autoClear = false;
      }

      function render() {
        var timer = 0.0001 * Date.now();
        effect.render( scene, camera );
        
      }

      function onDocumentMouseMove( event ) {

        mouseX = ( event.clientX - windowHalfX ) * 1;
        mouseY = ( event.clientY - windowHalfY ) * 1;

      }

      var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

      document.addEventListener( 'mousemove', onDocumentMouseMove, false );
      
      init();
      animate();
    </script>
  </body>
</html>